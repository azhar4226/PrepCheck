<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subject Management - Add Chapters Button Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { margin: 5px; padding: 10px 15px; }
        .feature-box { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .chapter-list { border: 1px solid #eee; padding: 10px; margin: 10px 0; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>Subject Management - Add Chapters Feature</h1>
    <div id="status" class="status info">Testing the new Add Chapters functionality...</div>
    
    <div class="feature-box">
        <h3>‚ú® New Feature: Chapter Management</h3>
        <ul>
            <li>‚úÖ <strong>"Chapters" button added</strong> to each subject row</li>
            <li>‚úÖ <strong>Chapter Management Modal</strong> to view and manage chapters</li>
            <li>‚úÖ <strong>"Add Chapter" functionality</strong> within the modal</li>
            <li>‚úÖ <strong>Real-time chapter count</strong> updates in subject list</li>
            <li>‚úÖ <strong>Chapter validation</strong> and error handling</li>
        </ul>
    </div>
    
    <div class="feature-box">
        <h3>üîß How It Works:</h3>
        <ol>
            <li>Click the <strong>"Chapters"</strong> button next to any subject</li>
            <li>A modal opens showing all chapters for that subject</li>
            <li>Click <strong>"Add Chapter"</strong> to create a new chapter</li>
            <li>Fill out the chapter details and save</li>
            <li>The chapter list updates automatically</li>
            <li>Subject list refreshes to show updated chapter count</li>
        </ol>
    </div>
    
    <h3>üß™ Test Chapter Management API:</h3>
    <button onclick="testLogin()">1. Login as Admin</button>
    <button onclick="testGetSubjects()" id="subjectsBtn" disabled>2. Get Subjects</button>
    <button onclick="testGetChapters()" id="chaptersBtn" disabled>3. Get Chapters</button>
    <button onclick="testCreateChapter()" id="createChapterBtn" disabled>4. Create Chapter</button>
    
    <div id="test-result"></div>
    
    <h3>üìä Current Subjects & Chapters:</h3>
    <div id="subjects-list"></div>
    
    <h3>üîó Test in Vue App:</h3>
    <div class="feature-box">
        <p><strong>Go to:</strong> <a href="http://localhost:3001/admin/subjects" target="_blank" rel="noopener">Subject Management Page</a></p>
        <p><strong>Instructions:</strong></p>
        <ol>
            <li>Login with admin@prepcheck.com / admin123</li>
            <li>Look for the "Chapters" button in each subject row</li>
            <li>Click the "Chapters" button next to any subject</li>
            <li>Click "Add Chapter" in the modal that opens</li>
            <li>Fill out the chapter form and create</li>
        </ol>
    </div>
    
    <script>
        let authToken = null;
        let subjects = [];
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        async function testLogin() {
            try {
                updateStatus('Testing admin login...', 'info');
                const response = await axios.post('http://localhost:8000/api/auth/login', {
                    email: 'admin@prepcheck.com',
                    password: 'admin123'
                });
                
                authToken = response.data.access_token;
                axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;
                
                document.getElementById('test-result').innerHTML = 
                    `<div class="status success">‚úÖ Login successful!</div>`;
                document.getElementById('subjectsBtn').disabled = false;
                updateStatus('Login successful! Now test subjects API.', 'success');
            } catch (error) {
                document.getElementById('test-result').innerHTML = 
                    `<div class="status error">‚ùå Login failed: ${error.message}</div>`;
                updateStatus('Login failed!', 'error');
            }
        }
        
        async function testGetSubjects() {
            try {
                updateStatus('Testing subjects API...', 'info');
                const response = await axios.get('http://localhost:8000/api/admin/subjects');
                subjects = response.data;
                
                displaySubjects();
                
                document.getElementById('test-result').innerHTML = 
                    `<div class="status success">‚úÖ Subjects loaded! Found ${subjects.length} subjects</div>`;
                document.getElementById('chaptersBtn').disabled = false;
                updateStatus('Subjects loaded! Check the list below.', 'success');
            } catch (error) {
                document.getElementById('test-result').innerHTML = 
                    `<div class="status error">‚ùå Subjects failed: ${error.message}</div>`;
                updateStatus('Subjects test failed!', 'error');
            }
        }
        
        async function testGetChapters() {
            try {
                updateStatus('Testing chapters API for Mathematics...', 'info');
                const response = await axios.get('http://localhost:8000/api/admin/chapters?subject_id=1');
                
                document.getElementById('test-result').innerHTML = 
                    `<div class="status success">‚úÖ Chapters loaded for Mathematics!<br>
                    Found ${response.data.length} chapters:<br>
                    ${response.data.map(c => `‚Ä¢ ${c.name} (${c.quizzes_count || 0} quizzes)`).join('<br>')}</div>`;
                document.getElementById('createChapterBtn').disabled = false;
                updateStatus('Chapters API working!', 'success');
            } catch (error) {
                document.getElementById('test-result').innerHTML = 
                    `<div class="status error">‚ùå Chapters failed: ${error.message}</div>`;
                updateStatus('Chapters test failed!', 'error');
            }
        }
        
        async function testCreateChapter() {
            try {
                updateStatus('Testing create chapter API...', 'info');
                const response = await axios.post('http://localhost:8000/api/admin/chapters', {
                    name: 'Test Chapter from Frontend',
                    description: 'Created from test page',
                    subject_id: 1,
                    is_active: true
                });
                
                document.getElementById('test-result').innerHTML = 
                    `<div class="status success">‚úÖ Chapter created successfully!<br>
                    <strong>Chapter ID:</strong> ${response.data.chapter.id}<br>
                    <strong>Name:</strong> ${response.data.chapter.name}<br>
                    <strong>Subject:</strong> ${response.data.chapter.subject_name}</div>`;
                updateStatus('Create chapter API working! Test the Vue app now.', 'success');
                
                // Refresh subjects to show updated count
                testGetSubjects();
            } catch (error) {
                document.getElementById('test-result').innerHTML = 
                    `<div class="status error">‚ùå Create chapter failed: ${error.message}</div>`;
                updateStatus('Create chapter test failed!', 'error');
            }
        }
        
        function displaySubjects() {
            const subjectsDiv = document.getElementById('subjects-list');
            if (subjects.length === 0) {
                subjectsDiv.innerHTML = '<p class="text-muted">No subjects loaded yet.</p>';
                return;
            }
            
            let html = '';
            subjects.forEach(subject => {
                html += `
                    <div class="chapter-list">
                        <h5>${subject.name} <small class="text-muted">(${subject.chapters_count} chapters)</small></h5>
                        <p class="text-muted">${subject.description || 'No description'}</p>
                        <small>Status: <span class="${subject.is_active ? 'text-success' : 'text-danger'}">${subject.is_active ? 'Active' : 'Inactive'}</span></small>
                    </div>
                `;
            });
            subjectsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
