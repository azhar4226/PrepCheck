<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subject Management Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Subject Management API Test</h1>
    <div id="status">Loading...</div>
    
    <div id="login-section">
        <h3>Step 1: Login</h3>
        <button onclick="testLogin()">Test Admin Login</button>
        <div id="login-result"></div>
    </div>
    
    <div id="subjects-section" style="display: none;">
        <h3>Step 2: Get Subjects</h3>
        <button onclick="testSubjects()">Test Get Subjects</button>
        <div id="subjects-result"></div>
    </div>

    <script>
        let authToken = null;
        
        // Configure axios
        axios.defaults.baseURL = 'http://localhost:8000';
        axios.defaults.headers.common['Content-Type'] = 'application/json';
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div style="color: ${type === 'error' ? 'red' : 'green'}">${message}</div>`;
        }
        
        async function testLogin() {
            try {
                updateStatus('Testing admin login...');
                const response = await axios.post('/api/auth/login', {
                    email: 'admin@prepcheck.com',
                    password: 'admin123'
                });
                
                authToken = response.data.access_token;
                axios.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;
                
                document.getElementById('login-result').innerHTML = 
                    `<div style="color: green;">✅ Login successful! User: ${response.data.user.full_name}</div>`;
                document.getElementById('subjects-section').style.display = 'block';
                updateStatus('Login successful! Now test subjects endpoint.');
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('login-result').innerHTML = 
                    `<div style="color: red;">❌ Login failed: ${error.message}</div>`;
                updateStatus('Login failed!', 'error');
            }
        }
        
        async function testSubjects() {
            try {
                updateStatus('Testing subjects endpoint...');
                const response = await axios.get('/api/admin/subjects');
                
                document.getElementById('subjects-result').innerHTML = 
                    `<div style="color: green;">✅ Subjects loaded successfully!<br>
                    <strong>Data:</strong><br>
                    <pre>${JSON.stringify(response.data, null, 2)}</pre></div>`;
                updateStatus('All tests passed! SubjectManagement should work correctly now.');
            } catch (error) {
                console.error('Subjects error:', error);
                document.getElementById('subjects-result').innerHTML = 
                    `<div style="color: red;">❌ Subjects failed: ${error.message}<br>
                    Status: ${error.response?.status}<br>
                    Response: ${JSON.stringify(error.response?.data, null, 2)}</div>`;
                updateStatus('Subjects test failed!', 'error');
            }
        }
        
        updateStatus('Ready to test! Click the login button first.');
    </script>
</body>
</html>
