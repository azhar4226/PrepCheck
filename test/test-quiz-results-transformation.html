<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results Data Transformation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .section { border: 1px solid #ddd; padding: 20px; margin: 20px 0; background: #f9f9f9; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 15px; border: 1px solid #e9ecef; white-space: pre-wrap; font-size: 12px; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .comparison > div { padding: 15px; border: 1px solid #ccc; }
        .field-mapping { margin: 10px 0; }
        .field-mapping .field { background: #e3f2fd; padding: 5px; margin: 2px 0; border-radius: 3px; }
        .field-mapping .arrow { text-align: center; font-weight: bold; color: #1976d2; }
        .fixed-status { color: green; }
    </style>
</head>
<body>
    <h1>Quiz Results Data Transformation Test</h1>
    <p><strong>Status:</strong> ‚úÖ <span class="fixed-status">FIXED</span> - Backend to Frontend data mapping</p>

    <div class="section success">
        <h3>‚úÖ Fix Verification</h3>
        <p>This test simulates the exact backend response from our quiz submission and shows how the data transformation works.</p>
        <p><strong>Backend Response:</strong> Real data from <code>POST /api/quiz/1/submit</code></p>
        <p><strong>Transformation:</strong> Applied in <code>QuizTaking.vue</code> submitQuiz function</p>
    </div>

    <div class="section info">
        <h3>üîç Data Transformation Analysis</h3>
        
        <div class="comparison">
            <div>
                <h4>Backend Response Structure</h4>
                <div class="field-mapping">
                    <div class="field">results.summary.correct_answers: 2</div>
                    <div class="field">results.summary.wrong_answers: 1</div>
                    <div class="field">results.summary.total_questions: 3</div>
                    <div class="field">results.summary.marks_obtained: 2</div>
                    <div class="field">results.summary.total_marks: 3</div>
                    <div class="field">results.summary.percentage: 66.67</div>
                    <div class="field">results.summary.time_taken: 14</div>
                    <div class="field">results.questions: [array]</div>
                </div>
            </div>
            
            <div>
                <h4>Frontend Component Expects</h4>
                <div class="field-mapping">
                    <div class="field">correct_answers: 2</div>
                    <div class="field">incorrect_answers: 1 ‚ö†Ô∏è</div>
                    <div class="field">total_questions: 3</div>
                    <div class="field">score: 2</div>
                    <div class="field">total_marks: 3</div>
                    <div class="field">percentage: 66.67</div>
                    <div class="field">time_taken: 14</div>
                    <div class="field">question_details: [array] ‚ö†Ô∏è</div>
                    <div class="field">accuracy: 66 (computed) ‚ö†Ô∏è</div>
                    <div class="field">unanswered: 0 (computed) ‚ö†Ô∏è</div>
                </div>
            </div>
        </div>
    </div>

    <div class="section warning">
        <h3>üîß Applied Transformation Logic</h3>
        <pre id="transformationCode">
// In QuizTaking.vue submitQuiz function:
const summary = response.data.results.summary;
const attempt = response.data.attempt;
const backendResults = response.data.results;

results.value = {
  // Direct mappings
  score: summary.marks_obtained,
  total_marks: summary.total_marks,
  percentage: summary.percentage,
  time_taken: summary.time_taken,
  correct_answers: summary.correct_answers,
  total_questions: summary.total_questions,
  
  // FIXED: Field name mappings
  incorrect_answers: summary.wrong_answers, // ‚úÖ Map wrong_answers ‚Üí incorrect_answers
  
  // FIXED: Computed fields
  accuracy: summary.total_questions > 0 ? 
    Math.round((summary.correct_answers / summary.total_questions) * 100) : 0,
  unanswered: summary.total_questions - (summary.correct_answers + summary.wrong_answers),
  
  // FIXED: Question data mapping
  question_details: backendResults.questions, // ‚úÖ Map questions ‚Üí question_details
  questions: backendResults.questions,        // Keep for compatibility
  
  // Additional data
  quiz_title: attempt.quiz_title,
  message: response.data.message
};
        </pre>
    </div>

    <div class="section">
        <h3>üìä Transformed Data Result</h3>
        <p>Based on the real backend response, here's what the frontend component will receive:</p>
        <pre id="transformedData"></pre>
    </div>

    <div class="section">
        <h3>üéØ Expected UI Components</h3>
        <p>With the fixed data transformation, the QuizResults component should now display:</p>
        <ul>
            <li>‚úÖ <strong>Score Display:</strong> 2/3 (66.67%)</li>
            <li>‚úÖ <strong>Performance Breakdown:</strong>
                <ul>
                    <li>Correct: 2/3 (66.67%)</li>
                    <li>Incorrect: 1/3 (33.33%)</li>
                    <li>Unanswered: 0/3 (0%)</li>
                    <li>Accuracy: 67%</li>
                </ul>
            </li>
            <li>‚úÖ <strong>Question Review:</strong> 3 questions with detailed answers</li>
            <li>‚úÖ <strong>Time Taken:</strong> 00:14</li>
        </ul>
    </div>

    <script>
        // Simulate the exact backend response we received
        const backendResponse = {
            "attempt": {
                "completed_at": "2025-06-15T08:16:08.515274",
                "id": 6,
                "is_completed": true,
                "percentage": 66.67,
                "quiz_id": 1,
                "quiz_title": "Basic Algebra Quiz",
                "score": 2,
                "started_at": "2025-06-15T08:15:54.470489",
                "time_taken": 14,
                "total_marks": 3,
                "user_id": 1
            },
            "message": "Quiz submitted successfully",
            "results": {
                "questions": [
                    {
                        "is_correct": true,
                        "marks_obtained": 1,
                        "question": {
                            "correct_option": "B",
                            "id": 1,
                            "marks": 1,
                            "option_a": "x = 3",
                            "option_b": "x = 5",
                            "option_c": "x = 7",
                            "option_d": "x = 10",
                            "question_text": "What is the value of x in the equation 2x + 5 = 15?",
                            "explanation": "2x + 5 = 15, so 2x = 10, therefore x = 5"
                        },
                        "user_answer": "B"
                    },
                    {
                        "is_correct": true,
                        "marks_obtained": 1,
                        "question": {
                            "correct_option": "C",
                            "id": 2,
                            "marks": 1,
                            "option_a": "y = 5",
                            "option_b": "y = 6",
                            "option_c": "y = 7",
                            "option_d": "y = 8",
                            "question_text": "Solve for y: 3y - 7 = 14",
                            "explanation": "3y - 7 = 14, so 3y = 21, therefore y = 7"
                        },
                        "user_answer": "C"
                    },
                    {
                        "is_correct": false,
                        "marks_obtained": 0,
                        "question": {
                            "correct_option": "A",
                            "id": 3,
                            "marks": 1,
                            "option_a": "x¬≤ + x - 6",
                            "option_b": "x¬≤ - x + 6",
                            "option_c": "x¬≤ + x + 6",
                            "option_d": "x¬≤ - x - 6",
                            "question_text": "What is the product of (x + 3)(x - 2)?",
                            "explanation": "(x + 3)(x - 2) = x¬≤ - 2x + 3x - 6 = x¬≤ + x - 6"
                        },
                        "user_answer": "D"
                    }
                ],
                "summary": {
                    "correct_answers": 2,
                    "marks_obtained": 2,
                    "percentage": 66.67,
                    "time_taken": 14,
                    "time_taken_formatted": "00:14",
                    "total_marks": 3,
                    "total_questions": 3,
                    "wrong_answers": 1
                }
            }
        };

        // Apply the transformation logic (same as in QuizTaking.vue)
        const summary = backendResponse.results.summary;
        const attempt = backendResponse.attempt;
        const backendResults = backendResponse.results;

        const transformedResults = {
            // Direct mappings
            score: summary.marks_obtained,
            total_marks: summary.total_marks,
            percentage: summary.percentage,
            time_taken: summary.time_taken,
            correct_answers: summary.correct_answers,
            total_questions: summary.total_questions,
            
            // FIXED: Field name mappings
            incorrect_answers: summary.wrong_answers, // Map wrong_answers ‚Üí incorrect_answers
            
            // FIXED: Computed fields
            accuracy: summary.total_questions > 0 ? 
                Math.round((summary.correct_answers / summary.total_questions) * 100) : 0,
            unanswered: summary.total_questions - (summary.correct_answers + summary.wrong_answers),
            
            // FIXED: Question data mapping
            question_details: backendResults.questions, // Map questions ‚Üí question_details
            questions: backendResults.questions,        // Keep for compatibility
            
            // Additional data
            quiz_title: attempt.quiz_title,
            message: backendResponse.message
        };

        // Display the transformed data
        document.getElementById('transformedData').textContent = JSON.stringify(transformedResults, null, 2);
        
        console.log('‚úÖ Backend Response:', backendResponse);
        console.log('‚úÖ Transformed for Frontend:', transformedResults);
        console.log('‚úÖ All required fields present:', {
            hasScore: 'score' in transformedResults,
            hasPercentage: 'percentage' in transformedResults,
            hasCorrectAnswers: 'correct_answers' in transformedResults,
            hasIncorrectAnswers: 'incorrect_answers' in transformedResults,
            hasAccuracy: 'accuracy' in transformedResults,
            hasQuestionDetails: 'question_details' in transformedResults,
            hasUnanswered: 'unanswered' in transformedResults
        });
    </script>
</body>
</html>
